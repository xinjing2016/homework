<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>郭新境39号抽奖项目</title>
		<link rel="stylesheet" href="css/inde.css" />
	</head>
	<body>
		
		
		
	<div id='box'>
		<ol class="bg">
			<li><div class="lala">一等奖</div><em></em></li>
			<li><div class="lala">二等奖</div><em></em></li>
			<li><div class="lala">三等奖</div><em></em></li>
			<li><div class="lala">四等奖</div><em></em></li>
			<li><div class="lala">五等奖</div><em></em></li>
			<li><div class="lala">六等奖</div><em></em></li>
			<li><div class="lala">七等奖</div><em></em></li>
			<li><div class="lala">八等奖</div><em></em></li>
			<li><div class="lala">九等奖</div><em></em></li>
			<li><div class="lala">十等奖</div><em></em></li>
			<li><div class="lala">十一等奖</div><em></em></li>
			<li><div class="lala">十二等奖</div><em></em></li>
			
		</ol>
		<div id="cursor"></div>
		<div id="btn">点我抽奖</div>
		
	</div>	
		
	<div class="win" >
		<div class="head clearfix">
			<span>X</span>
		</div>
		<p class="hi">
			恭喜您！
		</p>
		<p class="txt">
			获得了<strong >1</strong>等奖！
		</p>
	</div>	
		
		
	<script>
		window.onload = function(){
			
			//定义转盘类
			function Btn(btn,cursorP,win,close,num,obg){
				this.btn = btn;
				this.bg = oBg;
				this.cursorP = cursorP;
				this.win = win;
				this.close = close;
				this.num = num;
				this.lastIndex = 0;
				this.init();
				this.cursor();
				
				
			}//定义转盘的原型
			Btn.prototype = {
				
				init : function(){
					this.lastIndex = 0;//
//					var x = screen.width;
//					var y = screen.height;

				},
				cursor : function(){
					var This = this;//指向btn的实例化对象
					var pointer = this.cursorP;
					var cursor_r = 0;
					var temp_r = 0;
					
					this.btn.onclick = function(){
						this.lastIndex = (Math.floor(Math.random()*12));//生成的等奖 		
						var positon = (Math.floor(Math.random()*12));//生成的位置
						var cursor_rote = positon*30;		//指针转这么多	
						var index = this.lastIndex;						
						if(index<positon){
							temp_rote = Math.abs(index - positon)*30;
						}else{
							temp_rote = -Math.abs(index - positon)*30+360;
						}
						This.cursorP.style.cssText = 'transform:rotate( '+ (cursor_rote +1440+cursor_r) +'deg);transition: all 2s 1s';
						This.bg.style.cssText = 'transform:rotate( '+ (temp_rote +1440+temp_r) +'deg);transition: all 2s 0.5s';
						
						oCursor.addEventListener("webkitTransitionEnd", function(){ //动画结束时事件
							console.log(cursor_rote);
							console.log(temp_rote);
							cursor_r = 360 - cursor_rote;
							temp_r = 360 - temp_rote;
							this.style.cssText = 'transform:rotate('+ (cursor_rote) +'deg);transition: all 0s';//
							This.bg.style.cssText = 'transform:rotate('+ (temp_rote) +'deg);transition: all 0s';
							
							This.win.style.cssText = 'display: block;';
							
							oClose.onclick = function(){
								oWin.style.cssText='display:none;';
								
							}														
							This.num.innerHTML = (index==0?12:index);
							//This.num.innerHTML = index;
						}, false);					
					}									
				},				
				change : function(fn){
					obj.style.cssText = 'transform:rotate( '+ temp +'deg);transition: all 2s 0.5s';
				}
			}
									
//实例化
 			
                var oBtn = document.getElementById('btn');
				var oCursor = document.getElementById('cursor');
				var oWin = document.getElementsByClassName('win')[0];
				var oClose = document.getElementsByTagName('span')[0];
				var oNum = document.getElementsByTagName('strong')[0];
				var oBox = document.getElementById("box");
				var oBg = oBox.getElementsByClassName("bg")[0];
				
                new Btn(oBtn,oCursor,oWin,oClose,oNum,oBg);
           
				//alert(oClose);


		}//end of onload
	</script>
	</body>
</html>
